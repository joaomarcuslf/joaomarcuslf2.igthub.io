contact@joaomarcuslf.com<!DOCTYPE html>
<html>
  <head>
    <title>
      Golang 05 - Adicionando nossa API – João Marcus de Lemos Fernandes
    </title>
    <meta charset="utf-8" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=6.0"
    />
    <meta name="robot" content="all" />
    <meta name="rating" content="general" />
    <meta name="distribution" content="global" />
    <meta name="language" content="en,pt" />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="" />
    <link rel="apple-touch-icon" href="/images/logo-hex.webp" />
    <meta
      property="og:image"
      content="http://joaomarcuslf.com/images/logo-hex.webp"
    />
    <meta property="og:title" content="Golang 05 - Adicionando nossa API" />
    <meta
      property="twitter:title"
      content="Golang 05 - Adicionando nossa API"
    />
    <meta property="og:site_name" content="Golang 05 - Adicionando nossa API" />
    <meta name="description" content="Expectativas " />
    <meta property="og:description" content="Expectativas " />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Golang 05 - Adicionando nossa API - Expectativas "
      href="/feed.xml"
    />
    <meta
      name="keywords"
      content="Developer, Software engineer, Front-end, Full-stack, React, Javascript, Flask, Python, Joaomarcuslf, Tech Mentor, Mentorship, Mentoria, Senior Developer, Web development"
    />
    <meta
      name="abstract"
      content="My presentation website as Software developer"
    />
    <meta name="author" content="João Marcus de Lemos Fernandes" />
    <meta property="og:locale" content="en" />
    <link rel="canonical" href="https://joaomarcuslf.com/" />
    <meta property="og:url" content="https://joaomarcuslf.com/" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@joaomarcuslf" />
    <link rel="stylesheet" type="text/css" href="/old/assets/css/style.css" />
  </head>
  <body>
    <div id="main" role="main" class="main">
      <section
        class="hero is-link has-background is-mini bg-mentorship typewriter"
      >
        <div class="hero-body">
          <h1
            class="title"
            aria-label="Golang 05 - Adicionando nossa API"
            aria-hidden="true"
          >
            Golang 05 - Adicionando nossa API
          </h1>
          <h2 class="subtitle">Adicionando DB, e nossa API.</h2>
        </div>
      </section>
      <br />
      <div class="container">
        <article class="media">
          <div class="media-content">
            <div class="content">
              <h2 id="expectativas">Expectativas</h2>
              <p>
                Nessa aula vamos utilizar a lib Gin, para além de tornar nossas
                rotas mais elegantes, delcararmos nossas rotas definindo os
                verbos HTTP, e também vamos utilizar um modelo de API Rest para
                utilizamos um Dummy DB, e um CRUD básico. Consulte o conteúdo
                adicional para compreender melhor esses termos.
              </p>
              <hr />
              <p>Ponto de partida desse post:</p>
              <div>
                <article
                  class="project-card"
                  data-gh-project="joaomarcuslf/go-mentorship"
                >
                  <figure class="project-card-image">
                    <p class="image">
                      <img
                        src="https://raw.githubusercontent.com/devicons/devicon/master/icons/go/go-original.svg"
                        alt="go logo"
                        width="128"
                        height="128"
                      />
                    </p>
                  </figure>
                  <div class="project-card-content">
                    <header class="project-card-header">
                      <p class="project-card-suptitle">
                        On
                        <a
                          target="blank"
                          href="https://github.com/joaomarcuslf/go-mentorship/tree/lesson-05"
                          title="View on GitHub"
                          >GitHub</a
                        >
                        <small>#/tree/lesson-05</small>
                      </p>
                      <a
                        target="blank"
                        href="https://github.com/joaomarcuslf/go-mentorship/tree/lesson-05"
                        title="View on GitHub"
                      >
                        <h6 class="project-card-title">go-mentorship</h6>
                      </a>
                    </header>
                    <div class="project-card-body">
                      <dl class="project-card-details">
                        <dt>Forked</dt>
                        <dd class="fork">
                          <a
                            target="blank"
                            href="https://github.com/joaomarcuslf/go-mentorship/fork"
                            title="View fork details"
                          >
                          </a>
                        </dd>
                        <dt>Starred</dt>
                        <dd class="star">
                          <a
                            target="blank"
                            href="https://github.com/joaomarcuslf/go-mentorship/stargazers "
                            title="View fork details"
                          >
                          </a>
                        </dd>
                      </dl>
                    </div>
                  </div>
                </article>
              </div>
              <h2 id="adicionando-gin">Adicionando Gin</h2>
              <p>
                A lib Gin é uma lib muito produtiva para escrever aplicações
                Web, e como ela tem uma escrita muito próxima ao Express do
                Node, me agrada muito, então será ela que iremos utilizar.
              </p>
              <p>Primeiro rode:</p>
              <div class="language-bash highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>go get github.com/gin-gonic/gin
</code>
  </pre>
                </div>
              </div>
              <p>
                Isso deve atualizar ambos seus
                <code class="language-plaintext highlighter-rouge">go.mod</code>
                e
                <code class="language-plaintext highlighter-rouge">go.sum</code>
                para incluir a lib
                <code class="language-plaintext highlighter-rouge">gin</code>.
                Em seguida vamos fazer as adaptações necessárias para nossa
                aplicação.
              </p>
              <p>
                Vamos para o
                <code class="language-plaintext highlighter-rouge"
                  >render/page.go</code
                >, nesse arquivo nós vamos mudar principalmente a função Write,
                pois agora ao invés de usarmos o
                <code class="language-plaintext highlighter-rouge"
                  >ResponseWriter</code
                >, vamos usar o render do
                <code class="language-plaintext highlighter-rouge">Gin</code>, e
                também vamos remover o prefixo
                <code class="language-plaintext highlighter-rouge"
                  >templates/</code
                >
                do nosso
                <code class="language-plaintext highlighter-rouge">AsHome</code
                >, também porque o
                <code class="language-plaintext highlighter-rouge">Gin</code> já
                lida com isso.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">render</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"net/http"</span>

  <span class="s">"github.com/gin-gonic/gin"</span>
<span class="p">)</span>

<span class="c">/* ... */</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">page</span> <span class="o">*</span>
  <span class="n">Page</span>
  <span class="p">)</span> <span class="n">AsHome</span>
  <span class="p">()</span> <span class="o">*</span>
  <span class="n">Page</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">page</span>
  <span class="o">.</span>
  <span class="n">SetMeta</span>
  <span class="p">(</span>
    <span class="s">"QR Code Generator"</span>
  <span class="p">,</span>
    <span class="s">"A page to generate QR"</span>
  <span class="p">,</span>
    <span class="s">"index.html"</span>
  <span class="p">,</span>
    <span class="n">http</span>
  <span class="o">.</span>
  <span class="n">StatusOK</span>
  <span class="p">,</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c">/* ... */</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">page</span> <span class="o">*</span>
  <span class="n">Page</span>
  <span class="p">)</span> <span class="n">Write</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="o">*</span>
  <span class="n">Page</span> <span class="p">{</span>
  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">HTML</span>
  <span class="p">(</span>
    <span class="n">page</span>
  <span class="o">.</span>
  <span class="n">Status</span>
  <span class="p">,</span>
    <span class="n">page</span>
  <span class="o">.</span>
  <span class="n">Template</span>
  <span class="p">,</span>
    <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{</span>
      <span class="s">"Title"</span>
  <span class="o">:</span>       <span class="n">page</span>
  <span class="o">.</span>
  <span class="n">Title</span>
  <span class="p">,</span>
      <span class="s">"Description"</span>
  <span class="o">:</span> <span class="n">page</span>
  <span class="o">.</span>
  <span class="n">Description</span>
  <span class="p">,</span>
      <span class="s">"Error"</span>
  <span class="o">:</span>       <span class="n">page</span>
  <span class="o">.</span>
  <span class="n">Error</span>
  <span class="p">,</span>
    <span class="p">},</span>
  <span class="p">)</span>

  <span class="k">return</span> <span class="n">page</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                No
                <code class="language-plaintext highlighter-rouge"
                  >handlers/html.go</code
                >, nós vamos basicamente trocar o
                <code class="language-plaintext highlighter-rouge"
                  >w http.ResponseWriter, r *http.Request</code
                >
                pelo
                <code class="language-plaintext highlighter-rouge"
                  >c *gin.Context</code
                >, e perceba que mudamos um pouco a forma que pegamos o dado do
                form, e a forma que escrevemos enviamos o Writer:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">handlers</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"net/http"</span>

  <span class="s">"github.com/gin-gonic/gin"</span>
  <span class="n">render</span> <span class="s">"github.com/joaomarcuslf/qr-generator/render"</span>
  <span class="n">generator</span> <span class="s">"github.com/joaomarcuslf/qr-generator/services/generators"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">Home</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">render</span>
  <span class="o">.</span>
  <span class="n">NewPage</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">AsHome</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">Write</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">GenerateQr</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">qr</span> <span class="o">:=</span> <span class="n">generator</span>
  <span class="o">.</span>
  <span class="n">NewQRCode</span>
  <span class="p">()</span>

  <span class="n">err</span> <span class="o">:=</span> <span class="n">qr</span>
  <span class="o">.</span>
  <span class="n">SetBarcode</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">PostForm</span>
  <span class="p">(</span>
  <span class="s">"dataString"</span>
  <span class="p">))</span>
  <span class="o">.</span>
  <span class="n">ToPNG</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">Writer</span>
  <span class="p">)</span>

  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">render</span>
  <span class="o">.</span>
  <span class="n">NewPage</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">AsHome</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">SetError</span>
  <span class="p">(</span>
  <span class="n">err</span>
  <span class="p">,</span> <span class="n">http</span>
  <span class="o">.</span>
  <span class="n">StatusBadRequest</span>
  <span class="p">)</span>
  <span class="o">.</span>
  <span class="n">Write</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Já no
                <code class="language-plaintext highlighter-rouge"
                  >server/http.go</code
                >, é onde teremos uma mudança maior, mas vamos por partes:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">server</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"github.com/gin-gonic/gin"</span>
  <span class="n">web</span> <span class="s">"github.com/joaomarcuslf/qr-generator/handlers/web"</span>
<span class="p">)</span>

<span class="c">/* ... */</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">a</span> <span class="o">*</span>
  <span class="n">Server</span>
  <span class="p">)</span> <span class="n">Run</span>
  <span class="p">()</span> <span class="p">{</span>
  <span class="n">router</span> <span class="o">:=</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Default</span>
  <span class="p">()</span>

  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">LoadHTMLGlob</span>
  <span class="p">(</span>
  <span class="s">"templates/*"</span>
  <span class="p">)</span>
  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">Static</span>
  <span class="p">(</span>
  <span class="s">"/static"</span>
  <span class="p">,</span> <span class="s">"./static"</span>
  <span class="p">)</span>

  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">GET</span>
  <span class="p">(</span>
  <span class="s">"/"</span>
  <span class="p">,</span> <span class="n">web</span>
  <span class="o">.</span>
  <span class="n">Home</span>
  <span class="p">)</span>
  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">POST</span>
  <span class="p">(</span>
  <span class="s">"/generator"</span>
  <span class="p">,</span> <span class="n">web</span>
  <span class="o">.</span>
  <span class="n">GenerateQr</span>
  <span class="p">)</span>

  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">Run</span>
  <span class="p">(</span>
  <span class="s">":"</span> <span class="o">+</span> <span class="n">s</span>
  <span class="o">.</span>
  <span class="n">Port</span>
  <span class="p">)</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>Nós tiramos o IO, já que não é mais necessário.</p>
              <ul>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >router.LoadHTMLGlob("templates/*")</code
                  >: Aqui nós estamos declarando qual nossa pasta de templates.
                </li>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >router.Static("/static", "./static")</code
                  >: Aqui nós estamos declarando qual nossa pasta de arquivos
                  estáticos.
                </li>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >router.GET("/", web.Home)</code
                  >: Aqui nós estamos declarando o endpoint
                  <code class="language-plaintext highlighter-rouge">/</code>,
                  que é o endpoint que vai ser chamado quando o usuário acessar
                  a página inicial.
                </li>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >router.POST("/generator", web.GenerateQr)</code
                  >: Aqui nós estamos declarando o endpoint
                  <code class="language-plaintext highlighter-rouge"
                    >/generator</code
                  >, que é o endpoint que vai ser chamado quando o usuário
                  acessar a página de geração de QR.
                </li>
              </ul>
              <blockquote>
                <p>
                  E perceba que agora nós diferenciamos quando é um GET de um
                  POST.
                </p>
              </blockquote>
              <p>
                Com isso nós refatoramos nosso servidor para algo mais próximo
                de um servidor do mundo real.
              </p>
              <p>
                A partir daqui, nós iremos criar um Banco de Dados dummy, para
                escrevermos uma API, então se torna 100% opicional seguir.
              </p>
              <h2 id="dummy-db">Dummy DB</h2>
              <p>
                Nós vamos implementar um Dummy DB em JSON, e vamos utilizar a
                <a
                  href="https://refactoring.guru/pt-br/design-patterns/singleton"
                  >Design Pattern Singleton</a
                >, assim ao invés de abrirmos várias instâncias para ler o
                arquivo JSON, nós vamos reaproveitar a instância anterior.
              </p>
              <div class="language-bash highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="nb">mkdir </span>services/readers
<span class="nb">touch </span>services/readers/json.go
</code>
  </pre>
                </div>
              </div>
              <p>
                Vamos preencher nosso
                <code class="language-plaintext highlighter-rouge"
                  >services/readers/json.go</code
                >
                com os seguintes métodos:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">services</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"encoding/json"</span>
  <span class="s">"io/ioutil"</span>
  <span class="s">"os"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">Read</span>
  <span class="p">(</span>
  <span class="n">path</span> <span class="kt">string</span>
  <span class="p">)</span> <span class="p">([]</span>
  <span class="kt">byte</span>
  <span class="p">,</span> <span class="kt">error</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">jsonFile</span>
  <span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">os</span>
  <span class="o">.</span>
  <span class="n">Open</span>
  <span class="p">(</span>
  <span class="n">path</span>
  <span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="no">nil</span>
  <span class="p">,</span> <span class="n">err</span>
  <span class="p">}</span>
  <span class="k">defer</span> <span class="n">jsonFile</span>
  <span class="o">.</span>
  <span class="n">Close</span>
  <span class="p">()</span>

  <span class="n">byteValue</span>
  <span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span>
  <span class="o">.</span>
  <span class="n">ReadAll</span>
  <span class="p">(</span>
  <span class="n">jsonFile</span>
  <span class="p">)</span>

  <span class="k">return</span> <span class="n">byteValue</span>
  <span class="p">,</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Save</span>
  <span class="p">(</span>
  <span class="n">path</span> <span class="kt">string</span>
  <span class="p">,</span> <span class="n">data</span> <span class="k">interface</span>
  <span class="p">{})</span> <span class="p">{</span>
  <span class="n">file</span>
  <span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json</span>
  <span class="o">.</span>
  <span class="n">MarshalIndent</span>
  <span class="p">(</span>
  <span class="n">data</span>
  <span class="p">,</span> <span class="s">""</span>
  <span class="p">,</span> <span class="s">" "</span>
  <span class="p">)</span>

  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="nb">panic</span>
  <span class="p">(</span>
  <span class="n">err</span>
  <span class="p">)</span>
  <span class="p">}</span>
  <span class="n">err</span> <span class="o">=</span> <span class="n">ioutil</span>
  <span class="o">.</span>
  <span class="n">WriteFile</span>
  <span class="p">(</span>
  <span class="n">path</span>
  <span class="p">,</span> <span class="n">file</span>
  <span class="p">,</span> <span class="m">0644</span>
  <span class="p">)</span>

  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="nb">panic</span>
  <span class="p">(</span>
  <span class="n">err</span>
  <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Agora vamos ver como vamos utilizar esses métodos no nosso Dummy
                DB, rode os seguintes comandos no seu terminal:
              </p>
              <div class="language-bash highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="nb">mkdir </span>database
<span class="nb">touch </span>database/db.go

<span class="nb">touch</span> ./db.json
<span class="nb">echo</span> <span class="s1">'{"Sites": []}'</span> <span class="o">&gt;&gt;</span> ./db.json
</code>
  </pre>
                </div>
              </div>
              <p>
                Vamos preencher nosso
                <code class="language-plaintext highlighter-rouge"
                  >database/db.go</code
                >
                como se fosse um banco de dados local:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">database</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"encoding/json"</span>
  <span class="s">"fmt"</span>
  <span class="s">"math/rand"</span>

  <span class="n">json_reader</span> <span class="s">"github.com/joaomarcuslf/qr-generator/services/readers"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">Site</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">URL</span> <span class="kt">string</span>
  <span class="n">Id</span>  <span class="kt">string</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">DB</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Sites</span> <span class="p">[]</span>
  <span class="n">Site</span>
<span class="p">}</span>

<span class="k">var</span> <span class="n">instance</span> <span class="o">*</span>
  <span class="n">DB</span>
<span class="k">var</span> <span class="n">file</span> <span class="kt">string</span> <span class="o">=</span> <span class="s">"./db.json"</span>

<span class="k">func</span> <span class="n">NewDB</span>
  <span class="p">()</span> <span class="o">*</span>
  <span class="n">DB</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">byteValue</span>
  <span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json_reader</span>
  <span class="o">.</span>
  <span class="n">Read</span>
  <span class="p">(</span>
  <span class="n">file</span>
  <span class="p">)</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="nb">panic</span>
  <span class="p">(</span>
  <span class="n">err</span>
  <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="n">db</span> <span class="n">DB</span>

    <span class="n">json</span>
  <span class="o">.</span>
  <span class="n">Unmarshal</span>
  <span class="p">(</span>
  <span class="n">byteValue</span>
  <span class="p">,</span> <span class="o">&amp;</span>
  <span class="n">db</span>
  <span class="p">)</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="o">&amp;</span>
  <span class="n">db</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">instance</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Close</span>
  <span class="p">()</span> <span class="p">{</span>
  <span class="n">fmt</span>
  <span class="o">.</span>
  <span class="n">Println</span>
  <span class="p">(</span>
  <span class="s">"closing database"</span>
  <span class="p">)</span>
  <span class="k">if</span> <span class="n">instance</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">fmt</span>
  <span class="o">.</span>
  <span class="n">Println</span>
  <span class="p">(</span>
  <span class="s">"Creating database file"</span>
  <span class="p">)</span>
    <span class="n">json_reader</span>
  <span class="o">.</span>
  <span class="n">Save</span>
  <span class="p">(</span>
  <span class="n">file</span>
  <span class="p">,</span> <span class="n">instance</span>
  <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">DB</span>
  <span class="p">)</span> <span class="n">Save</span>
  <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">instance</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">json_reader</span>
  <span class="o">.</span>
  <span class="n">Save</span>
  <span class="p">(</span>
  <span class="n">file</span>
  <span class="p">,</span> <span class="n">instance</span>
  <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">DB</span>
  <span class="p">)</span> <span class="n">Add</span>
  <span class="p">(</span>
  <span class="n">url</span> <span class="kt">string</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">min</span> <span class="o">:=</span> <span class="m">10</span>
  <span class="n">max</span> <span class="o">:=</span> <span class="m">9999</span>

  <span class="n">id</span> <span class="o">:=</span> <span class="n">fmt</span>
  <span class="o">.</span>
  <span class="n">Sprintf</span>
  <span class="p">(</span>
  <span class="s">"%d"</span>
  <span class="p">,</span> <span class="n">rand</span>
  <span class="o">.</span>
  <span class="n">Intn</span>
  <span class="p">(</span>
  <span class="n">max</span>
  <span class="o">-</span>
  <span class="n">min</span>
  <span class="p">)</span>
  <span class="o">+</span>
  <span class="n">min</span>
  <span class="p">)</span>

  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span> <span class="o">=</span> <span class="nb">append</span>
  <span class="p">(</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span>
  <span class="p">,</span> <span class="n">Site</span>
  <span class="p">{</span>
    <span class="n">URL</span>
  <span class="o">:</span> <span class="n">url</span>
  <span class="p">,</span>
    <span class="n">Id</span>
  <span class="o">:</span>  <span class="n">id</span>
  <span class="p">,</span>
  <span class="p">})</span>

  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Save</span>
  <span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">DB</span>
  <span class="p">)</span> <span class="n">Get</span>
  <span class="p">(</span>
  <span class="n">id</span> <span class="kt">string</span>
  <span class="p">)</span> <span class="p">(</span>
  <span class="n">Site</span>
  <span class="p">,</span> <span class="kt">error</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">_</span>
  <span class="p">,</span> <span class="n">site</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">site</span>
  <span class="o">.</span>
  <span class="n">Id</span> <span class="o">==</span> <span class="n">id</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">site</span>
  <span class="p">,</span> <span class="no">nil</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">Site</span>
  <span class="p">{},</span> <span class="n">fmt</span>
  <span class="o">.</span>
  <span class="n">Errorf</span>
  <span class="p">(</span>
  <span class="s">"no site found, with id: %s"</span>
  <span class="p">,</span> <span class="n">id</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">DB</span>
  <span class="p">)</span> <span class="n">GetAll</span>
  <span class="p">()</span> <span class="p">[]</span>
  <span class="n">Site</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">DB</span>
  <span class="p">)</span> <span class="n">Update</span>
  <span class="p">(</span>
  <span class="n">id</span>
  <span class="p">,</span> <span class="n">url</span> <span class="kt">string</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">i</span>
  <span class="p">,</span> <span class="n">site</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">site</span>
  <span class="o">.</span>
  <span class="n">Id</span> <span class="o">==</span> <span class="n">id</span> <span class="p">{</span>
      <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span>
  <span class="p">[</span>
  <span class="n">i</span>
  <span class="p">]</span>
  <span class="o">.</span>
  <span class="n">URL</span> <span class="o">=</span> <span class="n">url</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Save</span>
  <span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">DB</span>
  <span class="p">)</span> <span class="n">Remove</span>
  <span class="p">(</span>
  <span class="n">id</span> <span class="kt">string</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">i</span>
  <span class="p">,</span> <span class="n">site</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">site</span>
  <span class="o">.</span>
  <span class="n">Id</span> <span class="o">==</span> <span class="n">id</span> <span class="p">{</span>
      <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span> <span class="o">=</span> <span class="nb">append</span>
  <span class="p">(</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span>
  <span class="p">[</span>
  <span class="o">:</span>
  <span class="n">i</span>
  <span class="p">],</span> <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Sites</span>
  <span class="p">[</span>
  <span class="n">i</span>
  <span class="o">+</span>
  <span class="m">1</span>
  <span class="o">:</span>
  <span class="p">]</span>
  <span class="o">...</span>
  <span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Save</span>
  <span class="p">()</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Espero que compreenda, o objetivo desses posts não é aprofundar
                em certas implementações, por isso não irei abordar como
                funciona DB locais, DB gerais, e etc. Caso surja curiosidade
                tente analisar o código acima, e em caso de dúvidas você pode
                <a href="#" onclick="mailMe('jmarcusfernandes@gmail.com')"
                  >entrar em contato comigo</a
                >.
              </p>
              <p>
                Agora abra
                <code class="language-plaintext highlighter-rouge"
                  >server/http.go</code
                >:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">server</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"github.com/gin-gonic/gin"</span>
  <span class="n">database</span> <span class="s">"github.com/joaomarcuslf/qr-generator/database"</span>
  <span class="n">web</span> <span class="s">"github.com/joaomarcuslf/qr-generator/handlers/web"</span>
<span class="p">)</span>

<span class="c">/* ... */</span>

<span class="k">func</span> <span class="p">(</span>
  <span class="n">a</span> <span class="o">*</span>
  <span class="n">Server</span>
  <span class="p">)</span> <span class="n">Run</span>
  <span class="p">()</span> <span class="p">{</span>
  <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">NewDB</span>
  <span class="p">()</span>
  <span class="k">defer</span> <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">Close</span>
  <span class="p">()</span>

  <span class="c">/* ... */</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Agora que temos nosso DB rodando, vamos abrir o
                <code class="language-plaintext highlighter-rouge"
                  >handlers/web/html.go</code
                >
                e vamos salvar executar um
                <code class="language-plaintext highlighter-rouge">.Add</code>
                para salvar o site que foi enviado.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">handlers</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"net/http"</span>

  <span class="s">"github.com/gin-gonic/gin"</span>
  <span class="n">database</span> <span class="s">"github.com/joaomarcuslf/qr-generator/database"</span>
  <span class="n">render</span> <span class="s">"github.com/joaomarcuslf/qr-generator/render"</span>
  <span class="n">generator</span> <span class="s">"github.com/joaomarcuslf/qr-generator/services/generators"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">db</span> <span class="o">*</span>
  <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">DB</span> <span class="o">=</span> <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">NewDB</span>
  <span class="p">()</span>

<span class="k">func</span> <span class="n">Home</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">render</span>
  <span class="o">.</span>
  <span class="n">NewPage</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">AsHome</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">Write</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">GenerateQr</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">qr</span> <span class="o">:=</span> <span class="n">generator</span>
  <span class="o">.</span>
  <span class="n">NewQRCode</span>
  <span class="p">()</span>

  <span class="n">input</span> <span class="o">:=</span> <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">PostForm</span>
  <span class="p">(</span>
  <span class="s">"dataString"</span>
  <span class="p">)</span>

  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Add</span>
  <span class="p">(</span>
  <span class="n">input</span>
  <span class="p">)</span>

  <span class="n">err</span> <span class="o">:=</span> <span class="n">qr</span>
  <span class="o">.</span>
  <span class="n">SetBarcode</span>
  <span class="p">(</span>
  <span class="n">input</span>
  <span class="p">)</span>
  <span class="o">.</span>
  <span class="n">ToPNG</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">Writer</span>
  <span class="p">)</span>

  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">render</span>
  <span class="o">.</span>
  <span class="n">NewPage</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">AsHome</span>
  <span class="p">()</span>
  <span class="o">.</span>
  <span class="n">SetError</span>
  <span class="p">(</span>
  <span class="n">err</span>
  <span class="p">,</span> <span class="n">http</span>
  <span class="o">.</span>
  <span class="n">StatusBadRequest</span>
  <span class="p">)</span>
  <span class="o">.</span>
  <span class="n">Write</span>
  <span class="p">(</span>
  <span class="n">c</span>
  <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Se você abrir sua aplicação agora, e gerar um QR code, você vai
                ver que o
                <code class="language-plaintext highlighter-rouge"
                  >db.json</code
                >
                foi atualizado com novos valores. Com isso vamos criar uma
                mini-api que possa retornar todos os Sites, e permita edição e
                deletar.
              </p>
              <h2 id="preenchendo-nossa-api">Preenchendo nossa API</h2>
              <p>Vamos escrever uma API:</p>
              <div class="language-bash highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="nb">mkdir </span>handlers/api
<span class="nb">touch </span>handlers/api/sites.go
</code>
  </pre>
                </div>
              </div>
              <p>
                Abra o
                <code class="language-plaintext highlighter-rouge"
                  >handlers/api/sites.go</code
                >
                e vamos preencher com nossos métodos CRUD:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">package</span> <span class="n">handlers</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"github.com/gin-gonic/gin"</span>
  <span class="n">database</span> <span class="s">"github.com/joaomarcuslf/qr-generator/database"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">SiteController</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">db</span> <span class="o">*</span>
  <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">DB</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">NewSiteController</span>
  <span class="p">()</span> <span class="o">*</span>
  <span class="n">SiteController</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span>
  <span class="n">SiteController</span>
  <span class="p">{</span>
    <span class="n">db</span>
  <span class="o">:</span> <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">NewDB</span>
  <span class="p">(),</span>
  <span class="p">}</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Primeiro método seria o
                <code class="language-plaintext highlighter-rouge"
                  >GET /sites</code
                >, que é o método de retornar todos.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">func</span> <span class="p">(</span>
  <span class="n">sc</span> <span class="o">*</span>
  <span class="n">SiteController</span>
  <span class="p">)</span> <span class="n">List</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">JSON</span>
  <span class="p">(</span>
  <span class="m">200</span>
  <span class="p">,</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{</span>
    <span class="s">"sites"</span>
  <span class="o">:</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">GetAll</span>
  <span class="p">(),</span>
  <span class="p">})</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Segundo método seria o
                <code class="language-plaintext highlighter-rouge"
                  >POST /sites</code
                >, que é o método de criar um novo site.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">func</span> <span class="p">(</span>
  <span class="n">sc</span> <span class="o">*</span>
  <span class="n">SiteController</span>
  <span class="p">)</span> <span class="n">Create</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">site</span> <span class="o">:=</span> <span class="o">&amp;</span>
  <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">Site</span>
  <span class="p">{}</span>
  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">BindJSON</span>
  <span class="p">(</span>
  <span class="n">site</span>
  <span class="p">)</span>

  <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Add</span>
  <span class="p">(</span>
  <span class="n">site</span>
  <span class="o">.</span>
  <span class="n">URL</span>
  <span class="p">)</span>

  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">JSON</span>
  <span class="p">(</span>
  <span class="m">204</span>
  <span class="p">,</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{})</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Terceiro método seria o
                <code class="language-plaintext highlighter-rouge"
                  >GET /sites/:id</code
                >, que é o método de retornar um site específico.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">func</span> <span class="p">(</span>
  <span class="n">sc</span> <span class="o">*</span>
  <span class="n">SiteController</span>
  <span class="p">)</span> <span class="n">Show</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">id</span> <span class="o">:=</span> <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">Param</span>
  <span class="p">(</span>
  <span class="s">"id"</span>
  <span class="p">)</span>

  <span class="n">site</span>
  <span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Get</span>
  <span class="p">(</span>
  <span class="n">id</span>
  <span class="p">)</span>

  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">JSON</span>
  <span class="p">(</span>
  <span class="m">404</span>
  <span class="p">,</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{</span>
      <span class="s">"error"</span>
  <span class="o">:</span> <span class="n">err</span>
  <span class="o">.</span>
  <span class="n">Error</span>
  <span class="p">(),</span>
    <span class="p">})</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">JSON</span>
  <span class="p">(</span>
  <span class="m">200</span>
  <span class="p">,</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{</span>
    <span class="s">"site"</span>
  <span class="o">:</span> <span class="n">site</span>
  <span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Quarto método seria o
                <code class="language-plaintext highlighter-rouge"
                  >PUT /sites/:id</code
                >, que é o método de atualizar um site específico.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">func</span> <span class="p">(</span>
  <span class="n">sc</span> <span class="o">*</span>
  <span class="n">SiteController</span>
  <span class="p">)</span> <span class="n">Update</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">id</span> <span class="o">:=</span> <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">Param</span>
  <span class="p">(</span>
  <span class="s">"id"</span>
  <span class="p">)</span>

  <span class="k">var</span> <span class="n">site</span> <span class="n">database</span>
  <span class="o">.</span>
  <span class="n">Site</span>

  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">BindJSON</span>
  <span class="p">(</span>
  <span class="o">&amp;</span>
  <span class="n">site</span>
  <span class="p">)</span>

  <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Update</span>
  <span class="p">(</span>
  <span class="n">id</span>
  <span class="p">,</span> <span class="n">site</span>
  <span class="o">.</span>
  <span class="n">URL</span>
  <span class="p">)</span>

  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">JSON</span>
  <span class="p">(</span>
  <span class="m">204</span>
  <span class="p">,</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{})</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Quinto método seria o
                <code class="language-plaintext highlighter-rouge"
                  >DELETE /sites/:id</code
                >, que é o método de deletar um site específico.
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">func</span> <span class="p">(</span>
  <span class="n">sc</span> <span class="o">*</span>
  <span class="n">SiteController</span>
  <span class="p">)</span> <span class="n">Delete</span>
  <span class="p">(</span>
  <span class="n">c</span> <span class="o">*</span>
  <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">Context</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="n">id</span> <span class="o">:=</span> <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">Param</span>
  <span class="p">(</span>
  <span class="s">"id"</span>
  <span class="p">)</span>

  <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">db</span>
  <span class="o">.</span>
  <span class="n">Remove</span>
  <span class="p">(</span>
  <span class="n">id</span>
  <span class="p">)</span>

  <span class="n">c</span>
  <span class="o">.</span>
  <span class="n">JSON</span>
  <span class="p">(</span>
  <span class="m">200</span>
  <span class="p">,</span> <span class="n">gin</span>
  <span class="o">.</span>
  <span class="n">H</span>
  <span class="p">{</span>
    <span class="s">"message"</span>
  <span class="o">:</span> <span class="s">"Site deleted"</span>
  <span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <p>
                Você que já conhece CRUD talvez estranhe a nomenclatura dos
                métodos que estou utilizando, eu estou me baseando na
                nomenclatura utilizada pelo Ruby on Rails na hora de definir os
                nomes do métodos, ela não é obrigatória, nem necessária, é mais
                uma questão de preferência. E vamos atualizar nosso
                <code class="language-plaintext highlighter-rouge"
                  >server/http.go</code
                >
                para chamar nosso
                <code class="language-plaintext highlighter-rouge"
                  >SiteController</code
                >:
              </p>
              <div class="language-go highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight">
  <code>
  <span class="k">func</span> <span class="p">(</span>
  <span class="n">a</span> <span class="o">*</span>
  <span class="n">Server</span>
  <span class="p">)</span> <span class="n">Run</span>
  <span class="p">()</span> <span class="p">{</span>
  <span class="c">/* ... */</span>

  <span class="n">sc</span> <span class="o">:=</span> <span class="n">api</span>
  <span class="o">.</span>
  <span class="n">NewSiteController</span>
  <span class="p">()</span>

  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">GET</span>
  <span class="p">(</span>
  <span class="s">"/api/sites"</span>
  <span class="p">,</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">List</span>
  <span class="p">)</span>
  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">POST</span>
  <span class="p">(</span>
  <span class="s">"/api/sites"</span>
  <span class="p">,</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">Create</span>
  <span class="p">)</span>
  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">GET</span>
  <span class="p">(</span>
  <span class="s">"/api/sites/:id"</span>
  <span class="p">,</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">Show</span>
  <span class="p">)</span>
  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">PUT</span>
  <span class="p">(</span>
  <span class="s">"/api/sites/:id"</span>
  <span class="p">,</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">Update</span>
  <span class="p">)</span>
  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">DELETE</span>
  <span class="p">(</span>
  <span class="s">"/api/sites/:id"</span>
  <span class="p">,</span> <span class="n">sc</span>
  <span class="o">.</span>
  <span class="n">Delete</span>
  <span class="p">)</span>

  <span class="n">router</span>
  <span class="o">.</span>
  <span class="n">Run</span>
  <span class="p">(</span>
  <span class="s">":"</span> <span class="o">+</span> <span class="n">a</span>
  <span class="o">.</span>
  <span class="n">Port</span>
  <span class="p">)</span>
<span class="p">}</span>
</code>
  </pre>
                </div>
              </div>
              <blockquote>
                <p>
                  Caso você não esteja entendendo esses nomes, isso é um padrão
                  REST de APIs, você pode ver um pouco mais sobre
                  <a
                    href="https://en.wikipedia.org/wiki/Representational_state_transfer"
                    >aqui</a
                  >
                </p>
              </blockquote>
              <p>
                Com isso você tem ambos um WEB App, e uma API, na próxima aula
                nós vamos introduzir o React para consumir a API. Espero você na
                próxima aula.
              </p>
              <h2 id="adicionais">Adicionais</h2>
              <ul>
                <li>
                  <a
                    href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods"
                    >Verbos HTTP</a
                  >
                </li>
                <li>
                  <a
                    href="https://developer.mozilla.org/en-US/docs/Glossary/CRUD"
                    >CRUD</a
                  >
                </li>
              </ul>
              <h2 id="link-do-projeto">Link do projeto:</h2>
              <div>
                <article
                  class="project-card"
                  data-gh-project="joaomarcuslf/go-mentorship"
                >
                  <figure class="project-card-image">
                    <p class="image">
                      <img
                        src="https://raw.githubusercontent.com/devicons/devicon/master/icons/go/go-original.svg"
                        alt="go logo"
                        width="128"
                        height="128"
                      />
                    </p>
                  </figure>
                  <div class="project-card-content">
                    <header class="project-card-header">
                      <p class="project-card-suptitle">
                        On
                        <a
                          target="blank"
                          href="https://github.com/joaomarcuslf/go-mentorship"
                          title="View on GitHub"
                          >GitHub</a
                        >
                      </p>
                      <a
                        target="blank"
                        href="https://github.com/joaomarcuslf/go-mentorship"
                        title="View on GitHub"
                      >
                        <h6 class="project-card-title">go-mentorship</h6>
                      </a>
                    </header>
                    <div class="project-card-body">
                      <dl class="project-card-details">
                        <dt>Forked</dt>
                        <dd class="fork">
                          <a
                            target="blank"
                            href="https://github.com/joaomarcuslf/go-mentorship/fork"
                            title="View fork details"
                          >
                          </a>
                        </dd>
                        <dt>Starred</dt>
                        <dd class="star">
                          <a
                            target="blank"
                            href="https://github.com/joaomarcuslf/go-mentorship/stargazers "
                            title="View fork details"
                          >
                          </a>
                        </dd>
                      </dl>
                    </div>
                  </div>
                </article>
              </div>
              <h2 id="lista-de-aulas">Lista de aulas:</h2>
              <ul>
                <li>
                  <a href="/old/mentorship/lesson-00-getting-started"
                    >Golang 00 - Primeiros passos</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-01-creating-app"
                    >Golang 01- Criando nosso App</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-02-refactoring"
                    >Golang 02 - Refatorando nossos serviços</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-03-web-server"
                    >Golang 03 - Adicionando nosso servidor</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-04-generate-qr"
                    >Golang 04 - Adicionando rota geradora</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-05-add-api"
                    >Golang 05 - Adicionando nossa API</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-06-consuming-api"
                    >Golang 06 - Consumindo API</a
                  >
                </li>
                <li>
                  <a href="/old/mentorship/lesson-07-expanding-the-front-end"
                    >Golang 07 - Expandindo o Front-end</a
                  >
                </li>
              </ul>
              <script>
                document.querySelector(
                  '[href="' + location.pathname + '"]'
                ).className = "is-underlined has-text-weight-bold";
              </script>
            </div>
          </div>
        </article>
      </div>
    </div>
    <script src="/old/assets/js/vendors/highlight.min.js"></script>
    <script src="/old/assets/js/post-page.js"></script>
    <script src="/old/assets/js/hljs.js"></script>
    <script src="/old/assets/js/mentorship.js"></script>
  </body>
</html>
