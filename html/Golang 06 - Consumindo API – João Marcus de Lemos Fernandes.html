<!DOCTYPE html><html><head><title> Golang 06 - Consumindo API – João Marcus de Lemos Fernandes </title><meta charset="utf-8"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=6.0"/><meta name="robot" content="all"/><meta name="rating" content="general"/><meta name="distribution" content="global"/><meta name="language" content="en,pt"/><meta name="robots" content="index,follow"/><meta name="theme-color" content=""/><link rel="apple-touch-icon" href="/assets/images/logo-hex.webp"/><meta property="og:image" content="http://joaomarcuslf.com/assets/images/logo-hex.webp"/><meta property="og:title" content="Golang 06 - Consumindo API"/><meta property="twitter:title" content="Golang 06 - Consumindo API"/><meta property="og:site_name" content="Golang 06 - Consumindo API"/><meta name="description" content="Expectativas "/><meta property="og:description" content="Expectativas "/><link rel="alternate" type="application/rss+xml" title="Golang 06 - Consumindo API - Expectativas " href="/feed.xml"></script><meta name="keywords" content="Developer, Software engineer, Front-end, Full-stack, React, Javascript, Flask, Python, Joaomarcuslf, Tech Mentor, Mentorship, Mentoria, Senior Developer, Web development"/><meta name="abstract" content="My presentation website as Software developer"/><meta name="author" content="João Marcus de Lemos Fernandes"/><meta property="og:locale" content="en"/><link rel="canonical" href="https://joaomarcuslf.com/"/><meta property="og:url" content="https://joaomarcuslf.com/"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@"/><meta name="twitter:creator" content="@joaomarcuslf"/><link rel="stylesheet" type="text/css" href="/assets/css/vendors.css"></script><link rel="stylesheet" type="text/css" href="/assets/css/style.css"/><link rel="stylesheet" type="text/css" href="/assets/css/mentorship.css"></script><link rel="alternate" type="application/rss+xml" title="@joaomarcuslf.com - Full-stack Software engineer - I'm Software Engineer since 2015 with great expertise in Front-end development. I like to teach a lot, and write some posts, you can check more here." href="/feed.xml"/><link rel="stylesheet" type="text/css" href="/assets/css/hljs.css"/></head><body><div id="main" role="main" class="main"><section class="hero is-link has-background is-mini bg-mentorship typewriter"><div class="hero-body"><h1 class="title" aria-label="Golang 06 - Consumindo API" aria-hidden="true"> Golang 06 - Consumindo API </h1><h2 class="subtitle">Adicionando nosso Front-end, e consumingo a API.</h2></div></section><br/><div class="container"><article class="media"><div class="media-content"><div class="content"><h2 id="expectativas">Expectativas</h2><p>Nessa aula vamos colocar React para rodar junto ao nosso projeto, e iremos adaptar nossa API para que ela seja consumida pelo nosso Front-end em React.</p><hr/><p>Ponto de partida desse post:</p><div><article class="project-card" data-gh-project="joaomarcuslf/go-mentorship"><figure class="project-card-image"><p class="image"><img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/go/go-original.svg" alt="go logo" width="128" height="128"/></p></figure><div class="project-card-content"><header class="project-card-header"><p class="project-card-suptitle"> On <a target="blank" href="https://github.com/joaomarcuslf/go-mentorship/tree/lesson-06" title="View on GitHub">GitHub</a><small>#/tree/lesson-06</small></p><a target="blank" href="https://github.com/joaomarcuslf/go-mentorship/tree/lesson-06" title="View on GitHub"><h6 class="project-card-title">go-mentorship</h6></a></header><div class="project-card-body"><dl class="project-card-details"><dt>Forked</dt><dd class="fork"><a target="blank" href="https://github.com/joaomarcuslf/go-mentorship/fork" title="View fork details"></a></dd><dt>Starred</dt><dd class="star"><a target="blank" href="https://github.com/joaomarcuslf/go-mentorship/stargazers " title="View fork details"></a></dd></dl></div></div></article></div><h2 id="o-que-você-precisa">O que você precisa?</h2><p>Você vai precisar ter NodeJS instalado, eu estou utilizando a versão <code class="language-plaintext highlighter-rouge">v17.0.1</code>, porém consulte a página dos módulos que utilizarmos para verificar compatibilidade. E também estou utilizando o <code class="language-plaintext highlighter-rouge">yarn</code> para rodar os comandos.</p><h2 id="criando-nosso-projeto">Criando nosso projeto</h2><p>Abra um terminal dentro do nosso projeto, e rode:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn create react-app  qr-generator
</code></pre></div></div><p>O comando irá demorar um pouco para rodar, enquanto isso vamos preparar outros aquivos.</p><h3 id="rodando-com-o-vscode">Rodando com o VSCode</h3><p>Se você seguiu o tutorial inteiro, você deve estar rodando o projeto pelo VSCode, e agora nós podemos rodar em paralelo tanto o Front-end quando o Back-end. Abra o <code class="language-plaintext highlighter-rouge">.vscode/launch.json</code>, e modifique ela para ficar assim.</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"compounds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Launch Full Application"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Launch Application (Go)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Launch Application (Node)"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"stopAll"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Launch Application (Node)"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"npm start"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node-terminal"</span><span class="p">,</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Launch Application (Go)"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"air server --port 8000"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node-terminal"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>Com isso na aba <code class="language-plaintext highlighter-rouge">Run and Debug</code>, você verá a opção de rodar com <code class="language-plaintext highlighter-rouge">Launch Full Application</code>, isso conclui essa etapa.</p><h3 id="atualizando-o-air">Atualizando o Air</h3><p>Abra o <code class="language-plaintext highlighter-rouge">.air.toml</code>, e vamos adicionar os arquivos de Front-end para ele ignorar quando tiverem atualizações.</p><div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[build]</span>
  <span class="err">/*</span> <span class="err">...</span> <span class="err">*/</span>
  <span class="py">exclude_dir</span> <span class="p">=</span> <span class="p">[</span><span class="s">"static"</span><span class="p">,</span> <span class="s">"tmp"</span><span class="p">,</span> <span class="s">"vendor"</span><span class="p">,</span> <span class="s">"testdata"</span><span class="p">,</span> <span class="s">"node_modules"</span><span class="p">,</span> <span class="s">"src"</span><span class="p">]</span>
  <span class="err">/*</span> <span class="err">...</span> <span class="err">*/</span>
</code></pre></div></div><p>Você também deve atualizar o <code class="language-plaintext highlighter-rouge">.gitignore</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qrcode.png
tmp/<span class="k">*</span>
db.json
/node_modules
.pnp<span class="k">*</span>
/coverage
/build
.env.<span class="k">*</span>
<span class="k">*</span><span class="nt">-debug</span>.log<span class="k">*</span>
</code></pre></div></div><h3 id="copiando-arquivos">Copiando arquivos</h3><p>Até aqui, o <code class="language-plaintext highlighter-rouge">yarn create</code> já deve ter terminado, e sim, vamos copiar os arquivos de dentro dessa past para a raiz do projeto.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> ./qr-generator/public ./
<span class="nb">mv</span> ./qr-generator/node_modules ./
<span class="nb">mv</span> ./qr-generator/package.json ./

<span class="nb">mkdir </span>src

<span class="nb">mv</span> ./qr-generator/src/setupTest.js ./src/setupTest.js

<span class="nb">rm</span> <span class="nt">-rf</span> ./qr-generator/
</code></pre></div></div><p>Com isso seu projeto já deve estar pronto, vá para próxima seção e vamos começar a preencher nosso código.</p><h2 id="fetcher">Fetcher</h2><p>Nós vamos escrever um componente que será responsável por fazer requisições HTTP e enviar os dados para os componentes filhos. Rode no seu terminal:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>src/fetcher
<span class="nb">touch </span>src/fetcher/fetcher.jsx
</code></pre></div></div><p>Abra <code class="language-plaintext highlighter-rouge">src/fetcher/fetcher.jsx</code> e vamos preenchendo juntos.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">Fetcher</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">action</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">setData</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">error</span><span class="p">,</span> <span class="nx">setError</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
</code></pre></div></div><p>Até aqui, estamos apenas declarando as props do nosso Fetcher, e seus estados iniciais. Nós vamos fazer uso do <code class="language-plaintext highlighter-rouge">useEffect</code> para fazer a requisição HTTP assim que o componente renderizar.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">loadData</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">action</span><span class="p">()</span>
        <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>

        <span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setError</span><span class="p">(</span><span class="nx">error</span><span class="p">?.</span><span class="nx">message</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">loadData</span><span class="p">()</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">action</span><span class="p">])</span>
</code></pre></div></div><p>Esse <code class="language-plaintext highlighter-rouge">useEffect</code> nos diz que ele tentará carregar os dados, e fará o controle do <code class="language-plaintext highlighter-rouge">result</code>, <code class="language-plaintext highlighter-rouge">error</code>, e <code class="language-plaintext highlighter-rouge">loading</code> conforme temos atualizações desses estados. E daqui para frente iremos só retornar com base em cada estado.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">error</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">children</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Fetcher</span>
</code></pre></div></div><p>Espero que não tenha ficado muito abstrato por hora, vai ficar mais claro quando implementarmos o resto do nosso código. Abra o terminal, nós vamos trabalhar aqui em fazer o componente que vai receber a listagem de sites.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>src/sites
<span class="nb">touch </span>src/sites/list.jsx
</code></pre></div></div><p>Abra o <code class="language-plaintext highlighter-rouge">sites/list.jsx</code>, e vamos preencher eles juntos.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">SitesList</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">sites</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">?.</span><span class="nx">data</span> <span class="o">||</span> <span class="p">{}</span>
</code></pre></div></div><p>Até aqui, coisa simples, nós esperamos um array de sites, e vamos ou retornar uma lista, ou uma mensagem dizendo que não temos sites.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Sites:<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

      <span class="si">{</span><span class="nx">sites</span><span class="p">?.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>No sites<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">sites</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">site</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="p">=</span><span class="si">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">site</span><span class="p">.</span><span class="nx">URL</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">site</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">site</span><span class="p">.</span><span class="nx">URL</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">))</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>Agora, vamos trabalhar a <code class="language-plaintext highlighter-rouge">action</code> que o <code class="language-plaintext highlighter-rouge">Fetcher</code> vai receber.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">SitesList</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:8000/api/sites</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div><p>Estaremos utilizando <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">fetch</a>, pois é o padrão recomendado para requisições HTTP. E por fim, vamos exportar o componente.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">default</span> <span class="nx">SitesList</span>
</code></pre></div></div><blockquote><p>A partir daqui, você já deve ter percebido que eu estou utilizando os nomes em minúsculo, e o CRA usa o padrão PascalCase. Eu prefiro a convenção de arquivos em minúsculo, mas você pode mudar isso se quiser. Outra coisa que você talvez já tenha percebido, é que tem arquivos com o final <code class="language-plaintext highlighter-rouge">test.js</code>, nós vamos escrever testes pros nossos arquivos, mas eu não vou me aprofundar em conteúdos de teste, pelo menos não por hora.</p></blockquote><p>Abra um terminal e rode o seguinte comando:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>src/sites/list.test.jsx
</code></pre></div></div><p>Abra o <code class="language-plaintext highlighter-rouge">src/sites/list.test.jsx</code>, e preencha comigo:</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint-disable testing-library/no-node-access */</span>
<span class="cm">/* eslint-disable testing-library/no-container */</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">screen</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@testing-library/react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">SitesList</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./list</span><span class="dl">'</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;SitesList /&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</code></pre></div></div><p>Sim, eu adicionei algumas regras que ignoram warnings do Eslint, você pode colocar num arquivo separado, eu deixei aqui mais para simplicidade.</p><p>O <code class="language-plaintext highlighter-rouge">describe</code> agrupa nossos testes, pense como se estivéssemos descrevendo determinado componente. E vamos começar com cada situação, a primeira é o componente não tendo uma lista para renderizar.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">renders an empty list</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">(&lt;</span><span class="nc">SitesList</span> <span class="p">/&gt;)</span>

    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/No sites/i</span><span class="p">)</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">toBeInTheDocument</span><span class="p">()</span>
  <span class="p">})</span>
</code></pre></div></div><p>Próxima condição seria tendo múltiplos elemento, e vamos testar isso.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">renders an list with multiple elements</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">container</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">render</span><span class="p">(&lt;</span><span class="nc">SitesList</span> <span class="na">data</span><span class="p">=</span><span class="si">{</span><span class="p">{</span><span class="na">sites</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">URL</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="p">},</span> <span class="p">{</span> <span class="na">URL</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="p">}</span> <span class="p">,{</span> <span class="na">URL</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="p">}</span> <span class="p">]}</span><span class="si">}</span> <span class="p">/&gt;)</span>

    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">)</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div><p>Sei que pode parecer bobo, porém esses testes são cruciais para quando formos adicionar opção de editar, e remover sites. E aproveitando a vibe, vamos testar o <code class="language-plaintext highlighter-rouge">fetcher</code>?</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>src/fetcher/fetcher.test.jsx
</code></pre></div></div><p>No arquivo <code class="language-plaintext highlighter-rouge">fetcher/fetcher.test.jsx</code> vamos lidar com testes assíncronos, você pode se aprofundar mais na documentação de cada método, porém iremos utilizar a seguinte estrutura:</p><ul><li><code class="language-plaintext highlighter-rouge">action: MockedPromise&lt;&gt;</code></li><li><code class="language-plaintext highlighter-rouge">WaitFor</code></li><li><code class="language-plaintext highlighter-rouge">Expect</code></li></ul><p>Vamos ver na prática:</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint-disable testing-library/prefer-query-by-disappearance */</span>
<span class="cm">/* eslint-disable testing-library/no-unnecessary-act */</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">screen</span><span class="p">,</span> <span class="nx">waitFor</span><span class="p">,</span> <span class="nx">waitForElementToBeRemoved</span><span class="p">,</span> <span class="nx">act</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@testing-library/react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Fetcher</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./fetcher</span><span class="dl">'</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;Fetcher /&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</code></pre></div></div><p>Até agora nada atípico, certo? Primeiro teste será o de loading:</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">&gt; loading: should call action function</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="na">json</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="na">info</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test loading</span><span class="dl">"</span> <span class="p">})</span> <span class="p">}))</span>

    <span class="nx">render</span><span class="p">(</span>
      <span class="p">&lt;</span><span class="nc">Fetcher</span> <span class="na">action</span><span class="p">=</span><span class="si">{</span><span class="nx">action</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">data</span><span class="p">.</span><span class="nx">info</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nc">Fetcher</span><span class="p">&gt;</span>
    <span class="p">)</span>

    <span class="k">await</span> <span class="nx">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">action</span><span class="p">).</span><span class="nx">toBeCalled</span><span class="p">())</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">action</span><span class="p">).</span><span class="nx">toBeCalled</span><span class="p">()</span>
  <span class="p">})</span>
</code></pre></div></div><p>Perceba que utilizamos os <code class="language-plaintext highlighter-rouge">jest</code> para mockar uma response, chamamos o render normal, e utilizamos o <code class="language-plaintext highlighter-rouge">await waitFor</code> para esperar que a função <code class="language-plaintext highlighter-rouge">action</code> seja chamada, pelo menos uma vez, e em seguida fazemos o teste de que a função <code class="language-plaintext highlighter-rouge">action</code> foi chamada.</p><p>Para o Error, e Success, eles seguem uma estrutura muito parecida:</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">&gt; error: should show error</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="na">json</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test error</span><span class="dl">"</span> <span class="p">})</span> <span class="p">}))</span>

    <span class="nx">act</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">render</span><span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Fetcher</span> <span class="na">action</span><span class="p">=</span><span class="si">{</span><span class="nx">action</span><span class="si">}</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">data</span><span class="p">.</span><span class="nx">info</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nc">Fetcher</span><span class="p">&gt;</span>
      <span class="p">)</span>
    <span class="p">})</span>

    <span class="k">await</span> <span class="nx">waitForElementToBeRemoved</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/Loading/i</span><span class="p">))</span>

    <span class="k">await</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/test error/i</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre></div></div><p>Porém, para esse cenário, não basta apenas a action ser chamada, o Loading tem que sair da tela, então nós esperamos pelo elemento ser removido. O success seria a mesma coisa, porém trocando <code class="language-plaintext highlighter-rouge">reject</code> por <code class="language-plaintext highlighter-rouge">resolve</code>.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">&gt; success: should show the content</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="na">json</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="na">info</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test success</span><span class="dl">"</span> <span class="p">})</span> <span class="p">}))</span>

    <span class="nx">act</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">render</span><span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Fetcher</span> <span class="na">action</span><span class="p">=</span><span class="si">{</span><span class="nx">action</span><span class="si">}</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">data</span><span class="p">.</span><span class="nx">info</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nc">Fetcher</span><span class="p">&gt;</span>
      <span class="p">)</span>
    <span class="p">})</span>


    <span class="k">await</span> <span class="nx">waitForElementToBeRemoved</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/Loading/i</span><span class="p">))</span>

    <span class="k">await</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/test success/i</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div><p>Com isso, você já entendeu como vai funcionar testes assíncronos, teste síncronos, e de quebra, você também viu como é a assinatura do nosso componente. Vamos agora fazer tudo renderizar.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>src/app.jsx
<span class="nb">touch </span>src/index.jsx
</code></pre></div></div><p>Abra o <code class="language-plaintext highlighter-rouge">src/app.jsx</code>, e vamos importar ambos o Fetcher e o SitesList, e renderizar:</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Fetcher</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./fetcher/fetcher</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">SiteList</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./sites/list</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Fetcher</span> <span class="na">action</span><span class="p">=</span><span class="si">{</span><span class="nx">SiteList</span><span class="p">.</span><span class="nx">action</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nc">SiteList</span> <span class="na">data</span><span class="p">=</span><span class="si">{</span><span class="nx">data</span><span class="si">}</span> <span class="p">/&gt;</span>
          <span class="p">)</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nc">Fetcher</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span>
</code></pre></div></div><p>Depois, abra o <code class="language-plaintext highlighter-rouge">src/index.jsx</code> para chamarmos o nosso App na DOM:</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-dom/client</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./app</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">createRoot</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">React</span><span class="p">.</span><span class="nc">StrictMode</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">App</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nc">React</span><span class="p">.</span><span class="nc">StrictMode</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div><p>Se você seguiu o tutorial até aqui, você pode abrir o <a href="http://localhost:3000">http://localhost:3000</a> e ver o resultado.</p><p>Você deve abrir as ferramentas de desenvolvedor do seu navegador, lá você verá que a requisição deu errado por conta do CORS, nó vamos resolver isso agora.</p><blockquote><p>Veja mais sobre o CORS <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">aqui</a>.</p></blockquote><h2 id="resolvendo-o-cors">Resolvendo o CORS</h2><p>Resolver CORS costuma ser algo que atormenta muitos desenvolvedores, porém a solução costuma também ser simples. Rode o comando no terminal.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go get github.com/gin-contrib/cors
</code></pre></div></div><p>Em seguida, abra o <code class="language-plaintext highlighter-rouge">server/http.go</code>, e adicione o módulo de CORS:</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"github.com/gin-contrib/cors"</span>
  <span class="c">/* ... */</span>
<span class="p">)</span>

<span class="c">/* ... */</span>

<span class="k">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">Server</span><span class="p">)</span> <span class="n">Run</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">database</span><span class="o">.</span><span class="n">NewDB</span><span class="p">()</span>
  <span class="k">defer</span> <span class="n">database</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

  <span class="n">router</span> <span class="o">:=</span> <span class="n">gin</span><span class="o">.</span><span class="n">Default</span><span class="p">()</span>
  <span class="n">router</span><span class="o">.</span><span class="n">Use</span><span class="p">(</span><span class="n">cors</span><span class="o">.</span><span class="n">Default</span><span class="p">())</span>
  <span class="c">/* ... */</span>
</code></pre></div></div><p>Prontinho, com isso seu Front-end já deve estar funcionando, e mostrando pelo menos uma lista básica de Sites.</p><p>Nas próximas aulas, nós vamos fazer o Front-end enviar POST, DELETE, e PUT para o Back-end, nesse meio tempo, que tal você entender o que fizemos no Front-end de forma mais profunda?</p><p>Aguardo na próxima aula.</p><h2 id="link-do-projeto">Link do projeto:</h2><div><article class="project-card" data-gh-project="joaomarcuslf/go-mentorship"><figure class="project-card-image"><p class="image"><img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/go/go-original.svg" alt="go logo" width="128" height="128"/></p></figure><div class="project-card-content"><header class="project-card-header"><p class="project-card-suptitle"> On <a target="blank" href="https://github.com/joaomarcuslf/go-mentorship" title="View on GitHub">GitHub</a></p><a target="blank" href="https://github.com/joaomarcuslf/go-mentorship" title="View on GitHub"><h6 class="project-card-title">go-mentorship</h6></a></header><div class="project-card-body"><dl class="project-card-details"><dt>Forked</dt><dd class="fork"><a target="blank" href="https://github.com/joaomarcuslf/go-mentorship/fork" title="View fork details"></a></dd><dt>Starred</dt><dd class="star"><a target="blank" href="https://github.com/joaomarcuslf/go-mentorship/stargazers " title="View fork details"></a></dd></dl></div></div></article></div><h2 id="lista-de-aulas">Lista de aulas:</h2><ul><li><a href="/mentorship/lesson-00-getting-started">Golang 00 - Primeiros passos</a></li><li><a href="/mentorship/lesson-01-creating-app">Golang 01- Criando nosso App</a></li><li><a href="/mentorship/lesson-02-refactoring">Golang 02 - Refatorando nossos serviços</a></li><li><a href="/mentorship/lesson-03-web-server">Golang 03 - Adicionando nosso servidor</a></li><li><a href="/mentorship/lesson-04-generate-qr">Golang 04 - Adicionando rota geradora</a></li><li><a href="/mentorship/lesson-05-add-api">Golang 05 - Adicionando nossa API</a></li><li><a href="/mentorship/lesson-06-consuming-api">Golang 06 - Consumindo API</a></li><li><a href="/mentorship/lesson-07-expanding-the-front-end">Golang 07 - Expandindo o Front-end</a></li></ul><script>document.querySelector('[href="'+location.pathname+'"]').className="is-underlined has-text-weight-bold";</script></div></div></article></div></div><script src="/assets/js/vendors/highlight.min.js"></script><script src="/assets/js/base.js"></script><script src="/assets/js/post-page.js"></script><script src="/assets/js/hljs.js"></script><script src="/assets/js/mentorship.js"></script></body></html>